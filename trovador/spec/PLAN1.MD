# trovador.io â€“ DAO + Blockchain System Implementation Plan

## ğŸ§­ Guiding Principles

- âœ… Top-down design (interfaces and contracts first)
- âœ… No breaking changes once interfaces are published
- âœ… Use .NET 8 (no external dependencies)
- âœ… Built-in dependency injection throughout
- âœ… Entity Framework Core for data persistence
- âœ… All tests use ASP.NET Core Test Host for integration
- âœ… Designed for containerized distribution (Docker)

---

## ğŸ“¦ Project Structure

```
/trovador
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ Trovador.API/
â”‚   â”œâ”€â”€ Trovador.Application/
â”‚   â”œâ”€â”€ Trovador.Domain/
â”‚   â”œâ”€â”€ Trovador.Infrastructure/
â”‚   â”œâ”€â”€ Trovador.Tests.Unit/
â”‚   â”œâ”€â”€ Trovador.Tests.Integration/
â”‚   â”œâ”€â”€ Trovador.Tests.E2E/
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ spec/
â”‚   â”œâ”€â”€ implementation-plan.md
â”‚   â”œâ”€â”€ GOVERNANCE.md
â”‚   â”œâ”€â”€ CONTRIBUTING.md
â”‚   â”œâ”€â”€ LICENSE
â”‚   â”œâ”€â”€ overview.md
â”‚   â””â”€â”€ README.md
â”œâ”€â”€ README.md
```

---

## âš™ï¸ Development Phases

### Phase 0 â€“ Architecture Definition
- Define all interfaces and DTOs
- Establish DI setup in `Program.cs`
- Configure EF Core with SQLite or InMemory provider (runtime switchable)

### Phase 1 â€“ Blockchain Engine
- Block validation, linking, and chain verification
- In-memory and EF-backed implementation
- Genesis block on startup

### Phase 2 â€“ Token Ledger
- Simulate token balances and transfers
- Ledger stored via EF Core
- Prevent negative balances and over-transfers

### Phase 3 â€“ DAO Proposals
- Create and list proposals
- Support expiration and metadata
- Store via EF Core with timestamps

### Phase 4 â€“ Voting System
- Weighted voting using token balance
- Prevent double voting
- Majority/quorum logic for approval
- Signature verification (optional)

### Phase 5 â€“ Node Synchronization
- Peer discovery (manual config or list)
- HTTP sync of blocks, votes, and proposals
- Chain replacement based on validity + length

### Phase 6 â€“ Console & Web UI (Optional)
- Simple CLI for admin actions
- Optionally: Razor Pages or Blazor Server interface

---

## ğŸ§ª Testing Strategy

### âœ… Unit Tests â€“ `Trovador.Tests.Unit`
- Test each service against its interface
- Use InMemory EF Core
- No networking or file I/O

### âœ… Integration Tests â€“ `Trovador.Tests.Integration`
- Use `WebApplicationFactory<Program>`
- Test real HTTP endpoints:
  - Proposal creation
  - Vote submission
  - Block synchronization
- Validate actual EF Core persistence and DI wiring

### âœ… E2E Tests â€“ `Trovador.Tests.E2E`
- Simulate multi-node deployments using Docker Compose
- Verify:
  - Cross-node sync
  - Full proposal/vote/block lifecycle
  - Data consistency and quorum agreement

---

## ğŸ§ª Test Case Checklist

### Blockchain Service
- AddBlock appends valid block
- Rejects block with wrong hash
- Chain validation returns correct result
- Accepts longer valid chain, rejects invalid chains

### Ledger Service
- GetBalance returns correct result
- Transfer updates balances
- Prevents overdrafts or unknown accounts

### Proposal Service
- CreateProposal saves proposal
- GetActiveProposals filters correctly
- GetProposalResult tallies vote totals

### Voting Service
- Vote persists vote
- Rejects duplicate or ineligible votes
- Tally calculates correctly and applies quorum

### Node Sync Service
- BroadcastBlock reaches all peers
- SyncChain replaces with valid longer chain
- Rejects invalid sync requests

---

## ğŸ³ Docker & Container Considerations

- `Dockerfile` builds minimal `Trovador.API` image
- `docker-compose.yml` launches multiple nodes with unique ports
- Tests must not use fixed paths or machine-specific configs
- Logs and database use volume mounts or memory as appropriate
- Health check endpoint (`/health`) required for orchestration

---

## ğŸ¤– About the Programming Agent (LLM)

This implementation plan and technical architecture for the `trovador.io` project was developed in collaboration between **Jose Manuel Ojeda Melgar** (project architect and lead developer) and an advanced **Large Language Model (LLM)** â€” ChatGPT, powered by **OpenAI's GPT-4o**.

### ğŸ§  Agent Profile

| Attribute              | Value |
|------------------------|-------|
| Model Name             | `gpt-4o` (GPT-4 Omni) |
| Developed By           | OpenAI |
| Programming Expertise  | C#, .NET 8, ASP.NET Core, Entity Framework Core, Docker, Web API, Blazor |
| Reasoning Capabilities | High-level architecture, code generation, optimization, unit/integration test planning |
| Code Style             | SOLID principles, interface-driven, dependency-injection first |
| Communication Style    | Structured, markdown-capable, top-down planning |
| Tooling Integration    | Markdown, Docker, YAML, EF Core Migrations, HTTP simulation, Test Host |
| Limitations            | Does not execute code natively â€” outputs must be reviewed and run by human developer or CI pipeline |

---

### ğŸ“š How This Plan Was Created

- The plan was defined through a series of structured conversations where **Jose Manuel Ojeda Melgar** guided the requirements for:
  - Educational blockchain design in C#
  - Multi-node DAO functionality
  - No-breaking-change top-down development
  - Clean architecture and testability
  - Docker-based distribution with integration tests

- The LLM agent acted as a **technical advisor and planner**, suggesting architecture layouts, development phases, module boundaries, and test strategies using only **built-in .NET 8 features**.

---

### ğŸ§© Agent Responsibilities in This Project

- Define a scalable, modular, and container-ready architecture for a blockchain-backed DAO system
- Enforce principles of interface-driven development and dependency injection
- Outline an integration test suite using ASP.NET Core WebApplicationFactory
- Provide testable logic contracts and entity design with Entity Framework Core
- Help document system behavior and lifecycle in human-readable Markdown

---

### ğŸ” Note on Autonomy

> While the LLM agent contributed structure and best practices, **all decisions, validation, implementation, and deployment remain under the supervision of Jose Manuel Ojeda Melgar and the trovador.io development team**. The LLM is a planning and scaffolding tool, not a substitute for review, testing, or secure deployment.
